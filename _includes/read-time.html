<!-- Calculate the post's reading time, and display the word count in tooltip -->

{% assign words = include.content | strip_html | number_of_words: 'auto' %}

<!-- words per minute -->

{% assign wpm = 180 %}
{% assign min_time = 1 %}

{% assign read_time = words | divided_by: wpm %}

{% unless read_time > 0 %}
  {% assign read_time = min_time %}
{% endunless %}

{% capture read_prompt %}
  {{- site.data.locales[include.lang].post.read_time.prompt -}}
{% endcapture %}

{% assign read_unit = site.data.locales[include.lang].post.read_time.unit %}
{% assign words_label = site.data.locales[include.lang].post.words %}
{% assign progress_label = site.data.locales[include.lang].post.read_time.progress | default: 'read' %}
{% if progress_label == 'read' and include.lang == 'ko' %}
  {% assign progress_label = '읽음' %}
{% endif %}
{% assign eta_label = site.data.locales[include.lang].post.read_time.eta | default: 'Finish by' %}
{% if eta_label == 'Finish by' and include.lang == 'ko' %}
  {% assign eta_label = '완독 예상' %}
{% endif %}
{% assign remaining_label = site.data.locales[include.lang].post.read_time.remaining | default: 'remaining' %}
{% if remaining_label == 'remaining' and include.lang == 'ko' %}
  {% assign remaining_label = '남음' %}
{% endif %}

<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="{{ words }} {{ site.data.locales[include.lang].post.words }}"
  data-read-minutes="{{ read_time }}"
  data-read-words="{{ words }}"
  data-read-progress-label="{{ progress_label }}"
  data-read-eta-label="{{ eta_label }}"
  data-read-remaining-label="{{ remaining_label }}"
>
  <span class="readtime__value">
    <em class="readtime__minutes">
      {{- read_time -}}
      {{ ' ' }}
      {{- read_unit -}}
    </em>
    <span class="readtime__separator" aria-hidden="true"> • </span>
    <span class="readtime__words">
      {{- words -}}
      {{ ' ' }}
      {{- words_label -}}
    </span>
    <span class="readtime__separator readtime__progress-separator d-none" aria-hidden="true"> • </span>
    <span class="readtime__progress d-none" aria-live="polite"></span>
    <span class="readtime__separator readtime__eta-separator d-none" aria-hidden="true"> • </span>
    <span class="readtime__eta d-none" aria-live="polite"></span>
  </span>
  {%- if include.prompt -%}
    {%- assign _prompt_words = read_prompt | number_of_words: 'auto' -%}
    {%- unless _prompt_words > 1 -%}{{ ' ' }}{%- endunless -%}
    {{ read_prompt }}
  {%- endif -%}
</span>
